<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Logs</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script>
        function loadDebugLogs() {
            // Retrieve test data from localStorage
            const adSlotId = localStorage.getItem('adSlotId');
            const bidHandler = localStorage.getItem('bidHandler');
            const searchTime = localStorage.getItem('searchTime');

            // OpenRTB mock request payload
            const requestPayload = JSON.stringify({
                "id": "1234567890",
                "imp": [{
                    "id": "1",
                    "banner": {
                        "w": 300,
                        "h": 250,
                        "pos": 1
                    },
                    "tagid": adSlotId, // Dynamic Ad Slot ID
                }],
                "site": {
                    "id": "98765",
                    "name": "example.com",
                    "domain": "example.com",
                    "page": "https://www.example.com/page",
                },
                "device": {
                    "ip": "192.168.1.1",
                    "ua": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3",
                    "os": "Windows",
                    "make": "Dell"
                },
                "user": {
                    "id": "user123",
                    "geo": {
                        "lat": 37.7749,
                        "lon": -122.4194,
                        "country": "US"
                    }
                }
            }, null, 2); // Pretty-print JSON

            // OpenRTB mock response payload
            const responsePayload = JSON.stringify({
                "id": "1234567890",  // Same ID as request
                "seatbid": [{
                    "seat": "1",
                    "bid": [{
                        "id": "bid123",
                        "impid": "1",
                        "price": 5.00,
                        "adid": "ad123",
                        "nurl": "https://example.com/win-notification",
                        "adm": "<html><body>Ad content</body></html>",
                        "adomain": ["example.com"],
                        "iurl": "https://example.com/ad.jpg"
                    }]
                }]
            }, null, 2); // Pretty-print JSON

            // Display the data in the UI
            document.getElementById('requestPayload').textContent = requestPayload;
            document.getElementById('responsePayload').textContent = responsePayload;
            document.getElementById('searchDetails').innerHTML = `
                <p><strong>Ad Slot ID:</strong> ${adSlotId}</p>
                <p><strong>Bid Handler:</strong> ${bidHandler}</p>
                <p><strong>Search Time:</strong> ${searchTime}</p>
            `;
        }

        window.onload = loadDebugLogs;
    </script>
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="card p-4 shadow-lg" style="max-width: 700px;">
            <h2 class="text-center mb-4">Debug Session Logs</h2>

            <!-- Displaying the search details (Ad Slot ID, Bid Handler, and Time) -->
            <div id="searchDetails" class="mb-4">
                <p><strong>Loading search details...</strong></p>
            </div>

            <!-- Collapsible Request Payload -->
            <div class="mb-3">
                <h5>
                    <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRequest" aria-expanded="false" aria-controls="collapseRequest">
                        <i class="bi bi-plus"></i> Request Payload
                    </button>
                </h5>
                <div class="collapse" id="collapseRequest">
                    <div class="card card-body" style="max-height: 300px; overflow-y: auto;">
                        <pre id="requestPayload" class="bg-light p-3 rounded">Loading...</pre>
                    </div>
                </div>
            </div>

            <!-- Collapsible Response Payload -->
            <div class="mb-3">
                <h5>
                    <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#collapseResponse" aria-expanded="false" aria-controls="collapseResponse">
                        <i class="bi bi-plus"></i> Response Payload
                    </button>
                </h5>
                <div class="collapse" id="collapseResponse">
                    <div class="card card-body" style="max-height: 300px; overflow-y: auto;">
                        <pre id="responsePayload" class="bg-light p-3 rounded">Loading...</pre>
                    </div>
                </div>
            </div>

            <!-- Back Button -->
            <div class="text-center">
                <a href="debug-setup.html" class="btn btn-secondary btn-lg">Back</a>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>

    <!-- Bootstrap Icons for plus/minus -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
</body>
</html>
