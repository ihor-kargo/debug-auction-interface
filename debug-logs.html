<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Debug Logs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet"/>
  <script>
    function loadDebugLogs() {
      const adSlotId = localStorage.getItem('adSlotId');
      const auctionType = localStorage.getItem('auctionType');
      const bidHandler = localStorage.getItem('bidHandler');
      const searchTime = localStorage.getItem('searchTime');

      const requestPayload = {
        id: "1234567890",
        imp: [{ id: "1", banner: { w: 300, h: 250, pos: 1 }, tagid: adSlotId }],
        site: { id: "98765", name: "example.com", domain: "example.com" },
        device: { ip: "192.168.1.1", os: "Windows", ua: "Mozilla/5.0" },
        user: { id: "user123", geo: { lat: 37.77, lon: -122.41 } }
      };

      const responsePayload = {
        id: "1234567890",
        seatbid: [{
          seat: "1",
          bid: [{
            id: "bid123",
            impid: "1",
            price: 5.0,
            adid: "ad123",
            adm: "<html>Ad content</html>"
          }]
        }]
      };

      document.getElementById('sd-adSlotId').textContent = adSlotId;
      document.getElementById('sd-auctionType').textContent = auctionType;
      document.getElementById('sd-bidHandler').textContent = bidHandler;
      document.getElementById('sd-searchTime').textContent = searchTime;

      document.getElementById('requestPayload1').textContent = JSON.stringify(requestPayload, null, 2);
      document.getElementById('requestPayload2').textContent = JSON.stringify(requestPayload, null, 2);
      document.getElementById('requestPayload3').textContent = JSON.stringify(requestPayload, null, 2);
      document.getElementById('responsePayload').textContent = JSON.stringify(responsePayload, null, 2);
    }

    function logout() {
      localStorage.removeItem('userEmail');
      window.location.href = "index.html";
    }

    function setUsername() {
      const userEmail = localStorage.getItem('userEmail');
      if (userEmail) {
        document.getElementById('username').textContent = `User: ${userEmail}`;
      } else {
        window.location.href = "index.html";
      }
    }

    window.onload = function () {
      setUsername();
      loadDebugLogs();
    };
  </script>
</head>
<body class="bg-light">
  
 <!-- Header -->
 <div class="container-fluid text-white py-2" style="background: linear-gradient(to right, #00b5e2, #00c7b1);">
    <div class="d-flex justify-content-between align-items-center">
      <span id="username" class="ms-3 fw-semibold">User: Loading...</span>
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle rounded-3" id="profileDropdown" data-bs-toggle="dropdown">
            <i class="bi bi-person"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><button class="dropdown-item" onclick="logout()">Logout</button></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mt-5">
    <div class="card shadow rounded-4 p-4">
      
      <!-- Aligned Search Details -->
<div class="mb-4">
    <div class="search-details">
      <div><strong>Ad Slot ID:</strong></div><div id="sd-adSlotId"></div>
      <div><strong>Auction Type:</strong></div><div id="sd-auctionType"></div>
      <div><strong>Bid Handler:</strong></div><div id="sd-bidHandler"></div>
      <div><strong>Search Time:</strong></div><div id="sd-searchTime"></div>
    </div>
  </div>
  
  <style>
    .search-details {
      display: grid;
      grid-template-columns: max-content 1fr;
      column-gap: 1rem;
      row-gap: 0.5rem;
      align-items: start;
    }
  </style>

      <!-- Accordion Logs -->
      <div class="accordion" id="logsAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
              Bid Request Received
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#logsAccordion">
            <div class="accordion-body">
              <pre id="requestPayload1" class="bg-light p-3 rounded-3" style="white-space: pre-wrap;"></pre>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
              Payload to Scylla
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#logsAccordion">
            <div class="accordion-body">
              <pre id="requestPayload2" class="bg-light p-3 rounded-3" style="white-space: pre-wrap;"></pre>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
              Response from Scylla
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#logsAccordion">
            <div class="accordion-body">
              <pre id="requestPayload3" class="bg-light p-3 rounded-3" style="white-space: pre-wrap;"></pre>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFour">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour">
              Response to Publisher
            </button>
          </h2>
          <div id="collapseFour" class="accordion-collapse collapse" data-bs-parent="#logsAccordion">
            <div class="accordion-body">
              <pre id="responsePayload" class="bg-light p-3 rounded-3" style="white-space: pre-wrap;"></pre>
            </div>
          </div>
        </div>
      </div>

      <!-- Back Button -->
      <div class="mt-4 text-center">
        <a href="debug-setup.html" class="btn btn-secondary rounded-3">Back</a>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
